University: ITMO University

Faculty: FICT

Course: Network programming

Year: 2022

Group: K34202

Author: Migulaeva Tatyana Alekseevna

Lab: Lab3

Date of create: 03.10.2022

Ход работы:

1. Поднимаем Ubuntu 20.04 на виртуальной машине на хосте. Она будет предназначена для NetBox. Соединяем её с виртуальной машиной в облаке Яндекса, используя Wireguard по аналогии с первой лабораторной работой. Проверяем, что связь есть (192.168.6.1 - IP адрес виртуальной машины в Яндексе)
![image](https://user-images.githubusercontent.com/64036217/194377252-084db740-88d7-4b89-b0de-f97912c0c85c.png)

2. Запускаем Netbox. Это требует установки большого количества зависимостей. Далее первый этап - это установка и настройка postgresql. Создаем базу данных Netbox с одноимённым пользователем, запускаем. Проверяем, что всё работает корректно.
![image](https://user-images.githubusercontent.com/64036217/194378936-24a0cf74-a20f-438f-9113-5343a98241e5.png)

3. После этого настраиваем nginx, добавляем туда информацию о Netbox. Поскольку всё будет разворачиваться локально, указываем локалхост в конфигурационном файле. После этого можно запустить сам Netbox и проверить, что он запускается корректно.
![image](https://user-images.githubusercontent.com/64036217/194379277-8eac3647-3920-41a4-aa20-9dc809838dd1.png)

4. Далее в браузере открываем ссылку на netbox и видим главную страницу.
![image](https://user-images.githubusercontent.com/64036217/194379601-f50b13b2-c3d5-47f2-82f3-92ac651d700e.png)

5. Изначально там нет никакой информации, мы вносим два наших роутера. В моём случае занесены Сайт и сопутствующая информация для того, чтобы можно было добавить роутер.
![image](https://user-images.githubusercontent.com/64036217/194379846-cccbe42f-d551-488e-8a76-46687ec0e858.png)

6. Далее вносим роутеры и информацию о них. На скриншоте также присутствует IP адрес, но по факту он будет внесён позднее.
![image](https://user-images.githubusercontent.com/64036217/194380018-930ebe06-6dfe-4ad5-ae28-138d96ad8b09.png)

7. Для внесения IP адреса требуется создать интерфейс на роутере. Таким образом, в Netbox записаны два роутера, их ID, названия, интерфейсы и IP адреса.
![image](https://user-images.githubusercontent.com/64036217/194380251-da451d29-f3e8-4562-b3c2-7c4738b3d01b.png)

8. Сохраняем всю эту информацию в формате csv. Файл присутствует в этой папке.
![image](https://user-images.githubusercontent.com/64036217/194380628-3d8b086d-1605-41b0-a034-3a3badaf0123.png)

9. Подключаемся по ssh с виртуальной машины Ubuntu на облачную машину и при помощи команды scp передаём этот файл в облачную машину. Он потребуется нам для работы с Ansible. На скриншоте можем видеть файл routers.csv среди остальных файлов, необходимых для работы.
![image](https://user-images.githubusercontent.com/64036217/194381120-2c5298ec-7423-4728-9563-b5565c4b24a1.png)

10. Начинаем работу над плейбуком. В папке он представлен в итоговом виде, во время работы я разделила основную цель на две подзадачи. Первая - спарсить csv файл и записать нужную нам информацию о роутере в отдельный файл. В данном случае за ключ берём UID роутера, так как это значение не будет изменяться. 
![image](https://user-images.githubusercontent.com/64036217/194402368-d1738efa-38bc-44cd-b53b-e98a72718afe.png)

 11. Запускаем, чтобы проверить правильность вывода. 
![image](https://user-images.githubusercontent.com/64036217/194403843-c4daa1ec-4d2f-4bf4-b0be-f8d548d9f9f1.png)

12. Теперь дописываем часть, связанную с установкой названия роутера. 
![image](https://user-images.githubusercontent.com/64036217/194403989-938ad699-da86-432f-9eb0-b6abc7afd868.png)

13. И запускаем весь плейбук целиком, в результате чего он берёт имя роутера из csv файла, сгенерированного Netbox, и присваивает это имя подключенному роутеру. Вывод результатов показывает, что всё работает корректно.
![image](https://user-images.githubusercontent.com/64036217/194404520-edba1430-fd53-449d-a488-5e972ed20116.png)

14. В консоли Микротика видим, что имя роутера изменилось.
![image](https://user-images.githubusercontent.com/64036217/194404787-4148d97c-f7c9-4e4d-9cfd-9105555c407f.png)

15. Теперь работаем над обратной задачей - необходимо информацию из роутера передать в Netbox. 
