University: [ITMO University](https://itmo.ru/ru/)

Faculty: [FICT](https://fict.itmo.ru)

Course: [Network programming](https://github.com/itmo-ict-faculty/network-programming)

Year: 2022

Group: K34202

Author: Migulaeva Tatyana Alekseevna

Lab: Lab1

Date of create: 20.09.2022

Date of finished: 


Тема работы: Установка CHR и Ansible, настройка VPN

Цель работы: развертывание виртуальной машины с установленной системой контроля конфигураций Ansible и установка CHR в VirtualBox


Ход работы:
1. Создаём виртуальную машину в Яндекс.Облаке на операционной системе Ubuntu.

2. Подключаемся к ней по ssh, устанавливаем ansible.
![Screenshot from 2022-09-22 12-06-22](https://user-images.githubusercontent.com/64036217/192327211-a69aa333-ff41-41bf-afb6-5cb8b9a54870.png)

3. В VirtualBox устанавливаем MikroTik 7 версии, это будет важно для дальнейшей работы. Здесь имеет смысл обратить внимание на то, что после загрузки в настройках VirtualBox необходимо отключить загрузочный диск вручную, тогда как на установке более привычных операционных систем это происходит автоматически.

4. После этого устанавливаем Wireguard на удалённую машину, прописываем в нём в файл условий интерфейса. Создаём пару ключей.

5. После этого начинаем работу с MikroTik. Было обнаружено, что большая часть инструкций по его использованию объясняют работу при помощи графического интерфейса WinBox. Работа в консоли тоже возможна, но создала впечатление более затруднительной, по этой причине было решено установить графический интерфейс.![Screenshot from 2022-09-22 12-48-03](https://user-images.githubusercontent.com/64036217/192327414-7d15525b-4639-42db-a30d-83178ab2ea07.png)

6. Графический интерфейс работает только на Windows, поэтому на собственную машину на Linux пришлось ставить эмулятор, умеющий запускать exe файлы. В итоге при помощи эмулятора удалось подключиться к виртуальной машине MikroTik.![image](https://user-images.githubusercontent.com/64036217/192330430-81ec12c3-132a-452f-a1e8-057e2ab8fe36.png)

7. Поскольку в качестве VPN был выбран WireGuard, и установлен MikroTik последней версии, заходим в настройку Wireguard и создаём там новый интерфейс.
8. Заполняем строки: MTU оставляем как указано, ListenPort узнаём командой вывода файла /etc/wireguard/wg0.conf на сервере, ключи будут сгененрированы автоматически.
![image](https://user-images.githubusercontent.com/64036217/192327940-a21d9a06-cfd7-4ea1-ab19-1f521d8c6e46.png)

10. Переходим во вторую вкладку, там создаём Peer - указываем только что созданный интерфейс, указываем публичный ключ сервера, его публичный IP, указанный ранее порт и сеть адресов, по которым будет идти подключение.
![image](https://user-images.githubusercontent.com/64036217/192328037-8d218e8e-a2e3-4533-8ab6-eb6015283af6.png)

12. В настройке IP - Addresses указываем выбранную сеть и созданный интерфейс.![image](https://user-images.githubusercontent.com/64036217/192328647-1481c72c-af9e-46c0-a09a-8539ebab66af.png)

13. В настройке IP - Firewall создаём NAT Rule masquerade, Masquerade NAT позволяет преобразовывать несколько IP-адресов в другой одиночный IP-адрес. Можно использовать маскарадный NAT, чтобы скрыть один или несколько IP-адресов во внутренней сети за IP-адресом, который нужно сделать общедоступным.![image](https://user-images.githubusercontent.com/64036217/192328745-d5511914-62ea-40d6-a330-8ab4edd602e8.png)

14. Теперь для проверки работоспособности запускаем ping к виртуальной машине по заданному IP адресу. Пинг идёт - следовательно, все настройки выполнены корректно.![image](https://user-images.githubusercontent.com/64036217/193008927-619d1876-4e91-4864-885d-61dc98bf4936.png)


15. В результате получаем связь по следующей схеме.
![image](https://user-images.githubusercontent.com/64036217/193008578-a3a1896f-f755-493e-897c-65f12e5f4f10.png)



Выводы: При помощи WireGuard возможно настроить VPN туннель между виртуальной машиной с операционной системой RouterOS и удалённой виртуальной машиной. Для работы с RouterOS достаточно удобно использовать графический интерфейс. Сложности в работе может вызвать необходимость работы с IP адресами и ключами доступа, так как из-за небольшой опечатки в цифрах ничего не будет работать, а обнаружить её достаточно сложно.
