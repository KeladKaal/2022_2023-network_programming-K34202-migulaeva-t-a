University: ITMO University

Faculty: FICT

Course: Network programming

Year: 2022

Group: K34202

Author: Migulaeva Tatyana Alekseevna

Lab: Lab4

Date of create: 19.10.2022

Ход работы:

1. Устанавливаем Vagrant для запуска необходимой виртуальной мшаины. Проверяем, что он установлен и работает корректно.
![image](https://user-images.githubusercontent.com/64036217/196666092-6de102d8-ac51-46b0-a1e2-5a9c28403cdb.png)

2. Клонируем репозиторий с заданиями, заходим в папку виртуальной машины, поднимаем её при помощи команды vagrant up.
![image](https://user-images.githubusercontent.com/64036217/196666732-0f4b47db-11b3-4e92-83de-d65059b077ea.png)

3. Открываем интерфейс виртуальной машины, заходим в аккаунт пользователя p4.
![image](https://user-images.githubusercontent.com/64036217/196666872-fde2cc03-603c-432e-a2ae-bb3d758796e5.png)

4. Далее в терминале заходим в папку первого задания, где видим файл basic.p4. По условию задачи в дальнейшем будет необходимо дописать его до работоспособного состояния, но в данный момент проверям, что mininet апускается и работает.
![image](https://user-images.githubusercontent.com/64036217/196667717-befbd70a-e07d-4b53-9f5b-e594398f243d.png)

5. Теперь необходимо дописать программу так, чтобы между роутерами шёл пинг. Поскольку у меня нет опыта работы с С, а опыт работы с С++ покрылся пылью, планирую в дальнейшем разобрать все основные моменты кода. Схема сети выглядит следующим образом:
6. ![image](https://user-images.githubusercontent.com/64036217/196674117-008da439-fcf9-4eea-a7a2-a03b029f3b41.png)

7. В самом начале видим подключение двух библиотек, а также задание константы. Первая библиотека - это основная библиотека P4, в которой объявляются встроенные конструкции P4. v1model необходима для работы со свичами, которые даны по условию. Далее задаётся константа длиной в 16 бит с названием TYPE_IPV4.
![image](https://user-images.githubusercontent.com/64036217/196668455-e1d526ca-ddd1-425a-8ece-2590cfa93bf3.png)

7. Далее в заголовках видим создание ещё нескольких типов переменных.
![image](https://user-images.githubusercontent.com/64036217/196673966-14048f32-cd58-4bc3-b945-924fe3addcaa.png)

8. Далее прописано, из чего состоит пакет ethernet - в данном случае задаются мак адреса отправителя и получателя, а также тип кадра. 
![image](https://user-images.githubusercontent.com/64036217/196740369-af469292-bb06-4b1a-9c5c-fa3e08936a3a.png)

9. После кадра ethernet задаётся заголовок ipv4. Все указанные переменные соответствуют полям заголовка.
![image](https://user-images.githubusercontent.com/64036217/196903161-2ab716de-aff5-4f2b-9b3d-e4ba4aa5d115.png)

![image](https://user-images.githubusercontent.com/64036217/196903018-7d0336e8-544f-4037-b9fa-e4fa66c0bb07.png)

10. Поле метадата оставим пустым, так как это учебный проект и нет необходимости что-либо документировать там. Далее задаются те типы, которые были описаны ранее - ethernet и ipv4.
![image](https://user-images.githubusercontent.com/64036217/196903854-a2d61b6b-6b1d-4ce8-8c23-380e88987c22.png)

11. Далее переходим к части программы, отвечающей за парсеры. Парсер в P4 — это функция, которая отображает пакеты в заголовках и метаданные, написанные уже на языке конечного автомата.
![image](https://user-images.githubusercontent.com/64036217/196913283-f27f052d-1390-41a6-b206-207452ceea43.png)

12. Обращаемся к официальному cheat-sheet по P4. Там описан state start, обязательный для любого парсера, и далее описан как раз нужный нам parse_ethernet. Можем также заменить здесь select, который в P4 является аналогом case, и помогает ветвлению. Здесь он нам будет необходим, так как далее нужно прописать работу с ipv4 header.
![image](https://user-images.githubusercontent.com/64036217/196914017-409b8933-da93-433a-83d5-ddfacf7d4bdb.png)

13. Прописываем ethernet parser как указано в примере, далее самостоятельно дописываем часть, отвечающую за ipv4. 
![image](https://user-images.githubusercontent.com/64036217/196915354-733c0953-f717-4181-9bd6-3c5cd15706ae.png)

14. Checksum verification оставим как было изначально, здесь изменять что-либо нет необходимости.
![image](https://user-images.githubusercontent.com/64036217/196915657-2c175032-29e7-45c3-9353-075489b2bfb6.png)

15. 




